# How to View AQE Hooks Data

## Overview
The AQE (Agentic Quality Engineering) hooks system stores all coordination data in multiple locations. This guide shows you how to access and query all the data generated by the agent swarm.

---

## üìä 1. SQLite Databases (Runtime Data)

### Database Locations
```bash
./.swarm/memory.db         # Main swarm coordination database (1.5MB)
./.hive-mind/hive.db      # Hive mind coordination (124KB)
./data/fleet.db           # Fleet management (96KB)
```

### Database Schema (15 Tables)
The SwarmMemoryManager uses 15 tables as defined in `src/core/memory/SwarmMemoryManager.ts`:

1. **memory_entries** - Key-value storage with access control
2. **memory_acl** - Access control lists
3. **hints** - Blackboard pattern hints
4. **events** - Event stream (30-day TTL)
5. **workflow_state** - Workflow checkpoints (never expires)
6. **patterns** - Learned patterns (7-day TTL)
7. **consensus_state** - Consensus proposals (7-day TTL)
8. **performance_metrics** - Performance tracking
9. **artifacts** - Code artifacts (never expires)
10. **sessions** - Session resumability
11. **agent_registry** - Agent lifecycle tracking
12. **goap_goals** - GOAP planning goals
13. **goap_actions** - GOAP planning actions
14. **goap_plans** - GOAP execution plans
15. **ooda_cycles** - OODA loop tracking

### How to Query the Database

#### Option 1: Install sqlite3 CLI
```bash
# Install sqlite3
sudo apt-get update && sudo apt-get install -y sqlite3

# Query memory entries
sqlite3 ./.swarm/memory.db "SELECT * FROM memory_entries;"

# Count entries by partition
sqlite3 ./.swarm/memory.db "SELECT partition, COUNT(*) FROM memory_entries GROUP BY partition;"

# View agent deployment status
sqlite3 ./.swarm/memory.db "SELECT key, value FROM memory_entries WHERE key LIKE 'deploy-%/status';"

# View events
sqlite3 ./.swarm/memory.db "SELECT type, source, timestamp FROM events ORDER BY timestamp DESC LIMIT 10;"

# View patterns
sqlite3 ./.swarm/memory.db "SELECT pattern, confidence, usage_count FROM patterns ORDER BY confidence DESC;"

# View performance metrics
sqlite3 ./.swarm/memory.db "SELECT metric, value, unit, agent_id FROM performance_metrics ORDER BY timestamp DESC LIMIT 10;"
```

#### Option 2: Use Node.js Script
```typescript
// scripts/query-aqe-memory.ts
import { SwarmMemoryManager } from './src/core/memory/SwarmMemoryManager';

async function queryMemory() {
  const memory = new SwarmMemoryManager('./.swarm/memory.db');
  await memory.initialize();

  // Get stats
  const stats = await memory.stats();
  console.log('Database Stats:', JSON.stringify(stats, null, 2));

  // Query deployment status
  const deployStatus = await memory.query('deploy-*', { partition: 'coordination' });
  console.log('Deployment Status:', deployStatus);

  // Query events
  const events = await memory.queryEvents('task.completed');
  console.log('Task Completion Events:', events);

  // Query patterns
  const patterns = await memory.queryPatternsByConfidence(0.8);
  console.log('High-Confidence Patterns:', patterns);

  await memory.close();
}

queryMemory();
```

Run it:
```bash
npx ts-node scripts/query-aqe-memory.ts
```

#### Option 3: Use SQLite Browser (GUI)
Download [DB Browser for SQLite](https://sqlitebrowser.org/) and open `./.swarm/memory.db`

---

## üìÅ 2. Pattern Documentation (Reusable Patterns)

### Location
```bash
docs/patterns/
‚îî‚îÄ‚îÄ eventbus-timing-fixes.md  # EventBus async timing patterns
```

### What's Stored
- **Problem descriptions** and root causes
- **Solution patterns** with code examples
- **Timing guidelines** (setImmediate, setTimeout delays)
- **Reusable templates** for async event testing
- **Test results** and validation metrics

### How to View
```bash
cat docs/patterns/eventbus-timing-fixes.md
```

---

## üìã 3. Agent Completion Reports

### Location
```bash
docs/reports/
‚îú‚îÄ‚îÄ DEPLOY-005-completion-report.md     # EventBus timing fixes
‚îú‚îÄ‚îÄ TEST-001-RESOLUTION-SUMMARY.md      # Coverage instrumentation
‚îú‚îÄ‚îÄ coverage-instrumentation-analysis.md # Coverage analysis
‚îú‚îÄ‚îÄ deploy-004-module-path-resolution.md # Module import fixes
‚îî‚îÄ‚îÄ SPRINT-1-IMPLEMENTATION-SUMMARY.md  # Overall summary
```

### What's Stored
- **Task completion status** (‚úÖ/‚è≥/‚ùå)
- **Implementation details** (files modified, code changes)
- **Test results** (pass/fail counts, validation)
- **Success criteria** verification
- **Next steps** and recommendations

### How to View
```bash
# View all reports
ls -lah docs/reports/

# Read specific report
cat docs/reports/DEPLOY-005-completion-report.md

# Search for specific task
grep -r "DEPLOY-002" docs/reports/
```

---

## üîç 4. Finding Specific Data

### Memory Keys Used by Agents

Based on the implementation summary, agents stored data with these key patterns:

```
deploy-001/status         # Jest environment fix
deploy-002/status         # Database mock fixes
deploy-003/status         # Floating point precision
deploy-004/status         # Module import paths
deploy-004/module-path    # Discovered module location
deploy-005/status         # EventBus timing
deploy-006/status         # ML model initialization
test-001/status           # Coverage instrumentation
```

### Query Example
```bash
# Using sqlite3
sqlite3 ./.swarm/memory.db "
  SELECT
    key,
    json_extract(value, '$.status') as status,
    json_extract(value, '$.timestamp') as timestamp
  FROM memory_entries
  WHERE key LIKE 'deploy-%/status'
  ORDER BY created_at;
"
```

---

## üìä 5. Event Emission (EventBus)

### Event Types Emitted
```typescript
'task.started'      // When agent starts a task
'task.completed'    // When agent finishes successfully
'task.blocked'      // When agent is blocked
'sprint.completed'  // When sprint phase completes
```

### Query Events
```bash
sqlite3 ./.swarm/memory.db "
  SELECT
    type,
    source,
    datetime(timestamp/1000, 'unixepoch') as time,
    json_extract(payload, '$.taskId') as task_id
  FROM events
  ORDER BY timestamp DESC
  LIMIT 20;
"
```

---

## üéØ 6. Performance Metrics (100-500x Speedup)

### Metrics Stored
- **Hook execution time** (< 1ms per call)
- **Memory operation time** (< 0.1ms)
- **Event emission time** (< 0.01ms)
- **Agent completion time**

### Query Performance
```bash
sqlite3 ./.swarm/memory.db "
  SELECT
    metric,
    AVG(value) as avg_value,
    MIN(value) as min_value,
    MAX(value) as max_value,
    unit
  FROM performance_metrics
  GROUP BY metric;
"
```

---

## üì¶ 7. Quick Access Scripts

### Create Query Helper Script
```bash
cat > scripts/query-aqe-data.sh << 'EOF'
#!/bin/bash

DB="./.swarm/memory.db"

echo "=== AQE Memory Database Statistics ==="
sqlite3 $DB "
  SELECT
    'Memory Entries' as table_name, COUNT(*) as count FROM memory_entries
  UNION ALL
  SELECT 'Events', COUNT(*) FROM events
  UNION ALL
  SELECT 'Patterns', COUNT(*) FROM patterns
  UNION ALL
  SELECT 'Performance Metrics', COUNT(*) FROM performance_metrics
  UNION ALL
  SELECT 'Artifacts', COUNT(*) FROM artifacts;
"

echo ""
echo "=== Deployment Status ==="
sqlite3 $DB "
  SELECT
    key,
    json_extract(value, '$.status') as status,
    datetime(created_at/1000, 'unixepoch') as created
  FROM memory_entries
  WHERE key LIKE 'deploy-%/status'
  ORDER BY created_at;
"

echo ""
echo "=== Recent Events (Last 10) ==="
sqlite3 $DB "
  SELECT
    type,
    source,
    datetime(timestamp/1000, 'unixepoch') as time
  FROM events
  ORDER BY timestamp DESC
  LIMIT 10;
"

echo ""
echo "=== Learned Patterns ==="
sqlite3 $DB "
  SELECT
    pattern,
    confidence,
    usage_count
  FROM patterns
  ORDER BY confidence DESC;
"
EOF

chmod +x scripts/query-aqe-data.sh
./scripts/query-aqe-data.sh
```

---

## üîê 8. Access Control Information

### View ACLs
```bash
sqlite3 ./.swarm/memory.db "
  SELECT
    resource_id,
    owner,
    access_level,
    json_extract(granted_permissions, '$') as permissions
  FROM memory_acl;
"
```

### Access Levels
- **private**: Only owner can access
- **team**: Team members can read
- **swarm**: All swarm agents can read
- **public**: Everyone can read
- **system**: System-level access

---

## üìà 9. Visualizing Data

### Export to JSON
```bash
# Export all memory entries
sqlite3 ./.swarm/memory.db "SELECT json_object('key', key, 'value', value, 'partition', partition) FROM memory_entries;" > memory-export.json

# Export events
sqlite3 ./.swarm/memory.db "SELECT json_object('type', type, 'source', source, 'timestamp', timestamp, 'payload', payload) FROM events;" > events-export.json
```

### Generate Reports
```bash
# Memory usage by partition
sqlite3 ./.swarm/memory.db "
  SELECT
    partition,
    COUNT(*) as entries,
    SUM(LENGTH(value)) as total_bytes
  FROM memory_entries
  GROUP BY partition;
"

# Agent activity summary
sqlite3 ./.swarm/memory.db "
  SELECT
    source as agent,
    COUNT(*) as events_emitted,
    MIN(datetime(timestamp/1000, 'unixepoch')) as first_event,
    MAX(datetime(timestamp/1000, 'unixepoch')) as last_event
  FROM events
  GROUP BY source;
"
```

---

## üéì Summary

**Data Locations:**
1. **SQLite Databases**: `./.swarm/memory.db` (runtime data - 15 tables)
2. **Pattern Files**: `docs/patterns/` (reusable patterns)
3. **Completion Reports**: `docs/reports/` (agent results)

**Key Memory Keys:**
- `deploy-*/status` - Deployment task status
- `aqe/*` - AQE system data
- `patterns/*` - Learned patterns
- `coordination/*` - Agent coordination

**Performance:**
- Hook execution: **< 1ms** (100-500x faster than external)
- Memory operations: **< 0.1ms** (500-2000x faster)
- Event emission: **< 0.01ms** (2000-10000x faster)

**Next Steps:**
1. Install sqlite3: `sudo apt-get install -y sqlite3`
2. Run query script: `./scripts/query-aqe-data.sh`
3. View reports: `cat docs/reports/SPRINT-1-IMPLEMENTATION-SUMMARY.md`
4. Explore patterns: `cat docs/patterns/eventbus-timing-fixes.md`

---

**Document Version:** 1.0
**Last Updated:** October 17, 2025
**Author:** Claude Code AQE Documentation System
